
s+
SELECT SYS_CONTEXT ('USERENV', 'SESSION_USER') FROM DUAL;
SELECT SYS_CONTEXT ('USERENV', 'DB_NAME') FROM DUAL;
SELECT SYS_CONTEXT ('USERENV', 'CURRENT_USER') FROM DUAL;

select sid,USERNAME,MACHINE,STATUS,LOGON_TIME,PROGRAM from v$session;

SQL@tSKDB> desc v$session

col USERNAME for a20
col MACHINE for a10
set lines 160
select sid,USERNAME,MACHINE,STATUS,LOGON_TIME,PROGRAM from v$session;


col USERNAME for a20
col MACHINE for a10
set lines 160
select sid,USERNAME,MACHINE,STATUS,LOGON_TIME,PROGRAM from v$session where USERNAME is not null;
## https://oracle-base.com/articles/12c/ofs-and-dbfs-enhancements-12cr2


grant select on v$session to student01;
grant select on v$session student02;
grant select on v$session student03;
grant select on v$session student04;
grant select on v$session student05;
grant select on v$session student06;
grant select on v$session student07;
grant select on v$session student08;
grant select on v$session student09;
grant select on v$session student10;
grant select on v$session student11;
grant select on v$session student12;


ADMINISTRACIA:
----------------------------------------
## https://www.pcwdld.com/sql-cheat-sheet#wbounce-modal

create user APPADM identified by "start123";
grant connect to APPADM;
grant create table to APPADM;
desc dba_users
select username, profile from dba_users;

ROLES:
---------------------------------------------------
create table test(id number);
insert into test values(1);
insert into test values(1);
insert into test values(1);

create user app2 identified by "start123";
create role demo;
grant connect to demo;
grant select,insert,update,delete on lektor01.welcome to demo;
create role demo2;
grant select,insert,update,delete on sys.test to demo2;
grant demo to demo2;
grant demo2 to app2;




grant dba to student01;
grant dba to student02;
grant dba to student03;
grant dba to student04;
grant dba to student05;
grant dba to student06;
grant dba to student07;
grant dba to student08;
grant dba to student09;
grant dba to student10;
grant dba to student11;
grant dba to student12;


TABLESPACES
----------------------------------------------------
set pagesize 2000;
define used_percent
column tablespace_name format a30;
select tablespace_name,
       round(sum(tbs_bytes_total)/1024/1024,3)  tot_MB,
       round((sum(tbs_bytes_total)- SUM(tbs_bytes_free ))/1024/1024,2) used_MB,
       round((SUM(tbs_bytes_free))/1024/1024,2) free_MB,
       round((sum(tbs_bytes_total) - SUM(tbs_bytes_free )) *100 / (sum(tbs_bytes_total))  ,2)  used_percent,
       100 - round((sum(tbs_bytes_total) - SUM(tbs_bytes_free )) *100 / (sum(tbs_bytes_total))  ,2) free_percent
       -- round(SUM(tbs_bytes_free/NULLIF(tbs_bytes_total,0))/1024/1024,2)*100 free_percent
from
 (SELECT tablespace_name, 0 tbs_bytes_total, SUM(bytes) tbs_bytes_free
  FROM   dba_free_space
  GROUP BY tablespace_name
 UNION
  SELECT tablespace_name   ,SUM(bytes)  tbs_bytes_total, 0 tbs_bytes_free
  FROM   v$datafile_header
  group by tablespace_name )
group by tablespace_name
order by used_percent asc;


alter user APPADM quota 2M on USERS;

select * from dba_profiles;

select * from v$parameter where parameter like ‘%FILE%’;

select * from session_privs;

## resize tablespace
alter database datafile ‘’ resize 200M;
alter tablespace add datafile ‘’ size 200M;


## check user grants 
---------------------------------------------------
set pages 0 feed off veri off lines 500

accept oldname prompt "Enter user to model new user to: "
accept newname prompt "Enter new user name: "


-- Grant Roles...
select 'grant '||granted_role||' to &&newname'||
       decode(ADMIN_OPTION, 'YES', ' WITH ADMIN OPTION')||';'
from   user_role_privs;

-- Grant System Privs...
select 'grant '||privilege||' to &&newname'||
       decode(ADMIN_OPTION, 'YES', ' WITH ADMIN OPTION')||';'
from   user_sys_privs;

-- Grant Table Privs...
select 'grant '||privilege||' on '||owner||'.'||table_name||' to &&newname;'
from   sys.user_tab_privs
where  grantee = upper('&&oldname');

-- Grant Column Privs...
select 'grant '||privilege||' on '||owner||'.'||table_name||
       '('||column_name||') to &&newname;'
from   sys.user_col_privs
where  grantee = upper('&&oldname');

-- Tablespace Quotas...
select 'alter user '||username||' quota '||
decode(max_bytes, -1, 'UNLIMITED', max_bytes)||
' on '||tablespace_name||';'
from sys.user_ts_quotas
where username = upper('&oldname');

-- Set Default Role...
set serveroutput on
declare
  defroles varchar2(4000);
begin
  for c1 in (select * from sys.user_role_privs
              where grantee = upper('&&oldname')
                and default_role = 'YES'
  ) loop
      if length(defroles) > 0 then
         defroles := defroles||','||c1.granted_role;
      else
         defroles := defroles||c1.granted_role;
      end if;
  end loop;
  dbms_output.put_line('alter user &&newname default role '||defroles||';');
end;
/

## clone_user - clone_user.sql
----------------------------------------------------
set pages 0 feed off veri off lines 500

accept oldname prompt "Enter user to model new user to: "
accept newname prompt "Enter new user name: "
-- accept psw     prompt "Enter new user's password: "

-- Create user...
select 'create user &&newname identified by values '''||password||''''||
-- select 'create user &&newname identified by &psw'||
       ' default tablespace '||default_tablespace||
       ' temporary tablespace '||temporary_tablespace||' profile '||
       profile||';'
from   sys.dba_users
where  username = upper('&&oldname');

-- Grant Roles...
select 'grant '||granted_role||' to &&newname'||
       decode(ADMIN_OPTION, 'YES', ' WITH ADMIN OPTION')||';'
from   sys.dba_role_privs
where  grantee = upper('&&oldname');

-- Grant System Privs...
select 'grant '||privilege||' to &&newname'||
       decode(ADMIN_OPTION, 'YES', ' WITH ADMIN OPTION')||';'
from   sys.dba_sys_privs
where  grantee = upper('&&oldname');

-- Grant Table Privs...
select 'grant '||privilege||' on '||owner||'.'||table_name||' to &&newname;'
from   sys.dba_tab_privs
where  grantee = upper('&&oldname');

-- Grant Column Privs...
select 'grant '||privilege||' on '||owner||'.'||table_name||
       '('||column_name||') to &&newname;'
from   sys.dba_col_privs
where  grantee = upper('&&oldname');

-- Tablespace Quotas...
select 'alter user '||username||' quota '||
decode(max_bytes, -1, 'UNLIMITED', max_bytes)||
' on '||tablespace_name||';'
from sys.dba_ts_quotas
where username = upper('&oldname');

-- Set Default Role...
set serveroutput on
declare
  defroles varchar2(4000);
begin
  for c1 in (select * from sys.dba_role_privs
              where grantee = upper('&&oldname')
                and default_role = 'YES'
  ) loop
      if length(defroles) > 0 then
         defroles := defroles||','||c1.granted_role;
      else
         defroles := defroles||c1.granted_role;
      end if;
  end loop;
  dbms_output.put_line('alter user &&newname default role '||defroles||';');
end;
/


## PRACA Z DATAMI
-------------------------------------------------------------------------------------
CREATE TABLE oddelenia
( dept_id number NOT NULL,
  dept_name varchar2(50) NOT NULL,
  dept_headof varchar2(50) NOT NULL,
);

CREATE TABLE zamestnanci
( emp_number number NOT NULL,
  last_name varchar2(50) NOT NULL,
  first_name varchar2(50) NOT NULL,
  salary number,
  dept_id number,
);


INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (114567,'GSO SAP 5','Verner, Igor');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (221267,'TSO AM 4','Lycka-Kubalakova, Edita');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (327659,'LIM','Kasper, Kornelis');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (309217,'EMEA GBO and LIM','Tokarova, Andrea');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (280905,'Citrix1','Zelikova, Jana');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (328245,'CU Shell','Fric Jozef');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (222824,'PC and Platform Services','Holan Peter');
INSERT INTO oddelenia (dept_id, dept_name, dept_headof) VALUES (311579,'DCO Systems Operations','Liba Dusan');

INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (460061, 'Molnar','Ivan', 700, 114567);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (329099, 'Molnar','Jozef', 820, 327659);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (534001, 'Beck','Samuel', 900, 309217);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (261942, 'Liba','Daniel', 650, 309217);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (209818, 'Vancakova','Ivana', 1200, 221267);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (292857, 'Szaboova', 'Slava',1500,328245);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (259133, 'Lipowski','Lubomir',1390,311579);
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (234501, 'Reckert','Falk',1900,311579); 
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (401932,'Bacova','Daniela',1370,280905); 
INSERT INTO zamestnanci (emp_number, last_name, first_name, salary, dept_id) VALUES (401484,'Kollarova','Veronika',1250,309217); 

select * from zamestnanci;

UPDATE zamestnanci SET salary = 2000;

DELETE FROM zamestnanci; 
DELETE FROM zamestnanci WHERE emp_number=XXX;





